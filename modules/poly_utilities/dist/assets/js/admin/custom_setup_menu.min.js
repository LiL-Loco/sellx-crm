(()=>{function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function _iterableToArrayLimit(e,t){var n,a,o,l,r,i,u,s=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=s){r=[],i=!0,u=!1;try{if(o=(s=s.call(e)).next,0===t){if(Object(s)!==s)return;i=!1}else for(;!(i=(n=o.call(s)).done)&&(r.push(n.value),r.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=s.return&&(l=s.return(),Object(l)!==l))return}finally{if(u)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}window.addEventListener("load",(function(){!function(e){"use strict";var t=Vue,n=t.createApp,a=t.ref,o=t.watch,l=t.onMounted,r=t.nextTick,i=n({setup:function setup(){function initDataDefault(){T.value={name:"",parent_slug:"root",target:"_self",rel:"nofollow",type:"default",badge:{color:"",value:""}}}function definedWatchLoad(){E=e(".poly-colorpicker-input-value"),O=e(".select2.roles"),H=e(".select2.users")}function updateColorPicker(){var e,t="",n=(null==T||null===(e=T.value)||void 0===e||null===(e=e.badge)||void 0===e?void 0:e.color)||t;E.val(n)}function fetchData(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Promise.all([fetchDefaultSettings(),fetchMenuItems(),fetchCustomMenuItems(),fetchRoles()]).then((function(e){var t=_slicedToArray(e,4),n=t[0],a=t[1],o=t[2],l=t[3];S.value=_toConsumableArray(a),o.forEach((function(e){try{e.aroles=e.roles?JSON.parse(e.roles):[]}catch(t){e.aroles=[]}try{e.ausers=e.users?JSON.parse(e.users):[]}catch(t){e.ausers=[]}})),A.value=o,x.value=n,M.value=l,I.value=!0})).catch((function(e){}))}function fetchDefaultSettings(){return new Promise((function(t,n){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_default_settings"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,a){n(a)}})}))}function fetchMenuItems(){return new Promise((function(t,n){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_setup_menu_items"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,a){n(a)}})}))}function fetchRoles(){return new Promise((function(t,n){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_roles"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,a){n(a)}})}))}function updateMenuOptions(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=e("body").find("#poly-active-menu .list-group-item").not(".list-group-item.sub"),a=!1,o=[];e.each(n,(function(t,n){var l,r,i,u,s,c,d,f,p=e(this);!1===a?a=t+1:a+=1,r={},i=p.data("parent_slug"),r.name=p.data("name"),u=p.data("is_custom"),r.is_custom=null!=u&&u,r.id=p.data("id"),r.slug=p.data("slug"),r.type=p.data("type"),r.css=p.data("css"),s=p.attr("data-disabled"),r.disabled="true"===s,r.roles=JSON.stringify(p.data("roles")),r.users=JSON.stringify(p.data("users")),r.href=null!==(l=p.data("href_original"))&&void 0!==l?l:p.data("href"),r.target=p.data("target"),r.rel=p.data("rel"),r.parent_slug=null!=i?i:"root",r.icon=p.data("icon"),r.badge=p.data("badge"),r.position=a,c=p.find(".list-group-item.sub"),d=!1,f=[],e.each(c,(function(t,n){var a,o,l,r,i;!1===d?d=t+1:d+=1,void 0!==(a=e(this)).data("id")&&((l={}).id=a.data("id"),l.name=a.data("name"),r=a.data("is_custom"),l.is_custom=null!=r&&r,l.slug=a.data("slug"),l.type=a.data("type"),l.css=a.data("css"),i=a.attr("data-disabled"),l.disabled="true"===i,l.roles=JSON.stringify(a.data("roles")),l.users=JSON.stringify(a.data("users")),l.href=null!==(o=a.data("href_original"))&&void 0!==o?o:a.data("href"),l.target=a.data("target"),l.rel=a.data("rel"),l.parent_slug=a.data("parent_slug"),l.icon=a.data("icon"),l.badge=a.data("badge"),l.position=d,f.push(l))})),r.children=f,o.push(r)})),e.post(admin_url+"poly_utilities/update_setup_menu_positions",{data:o}).done((function(e){var n=e;t||window.location.reload(),PolyMessage.displayNotification(n.status,n.message)}))}function fetchCustomMenuItems(){return new Promise((function(t,n){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_custom_setup_menu_items"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,a){n(a)}})}))}function handleStaffInfo(e){window.open("".concat(admin_url,"staff/member/").concat(e.id),"_blank")}function handleRoleInfo(e){window.open("".concat(admin_url,"roles/role/").concat(e.id),"_blank")}function isEdit(e){k.value=e}function validationForm(e,t){var n,a=Object.fromEntries(e.entries()),o=!0;return a.name.trim()?t.value.name=null:(t.value.name="Title cannot be empty.",o=!1),n=["default"],!a.href.trim()&&n.includes(T.value.type)?(t.value.href="Href cannot be empty.",o=!1):t.value.href=null,o}var t,n,i,u,s,c,d,f,p,m,v,y,h,_,g,b,C,w,x=a([]),S=a([]),T=a({}),A=a([]),M=a([]),I=a(!1),P=a(!1),k=a(!1),j=a([]),D=a([]),O=null,H=null,E=null,L=a({});return initDataDefault(),o([S,A,M,T],(function(){r().then((function(){definedWatchLoad(),t(),appColorPicker(),updateColorPicker(),PolyOperationFunctions.Icons(e(".poly-utilities-aio-icon-select")),O.length>0&&(O.select2({placeholder:"Select an option",width:"resolve"}),O.on("change",(function(e){var t=O.select2("data"),n=t.map((function(e){return{id:e.id,text:e.text}}));D.value=n}))),H.length>0&&(H.select2({placeholder:"Select users",width:"resolve",delay:250,minimumInputLength:2,ajax:{url:"".concat(admin_url,"poly_utilities/ajax_users_search"),dataType:"json",data:function data(e){var t;return{search:e.term,type:"public"}},processResults:function processResults(e){var t;return{results:e.map((function(e){return{id:e.staffid,text:"".concat(e.lastname," ").concat(e.firstname),avatar:e.avatar}}))}}},templateResult:function templateResult(t){return t.id?e('<div class="poly-utilities-user-search-result"><img src="'.concat(t.avatar,'" class="avatar-user"/> ').concat(t.text,"</div>")):t.text;var n},templateSelection:function templateSelection(t){var n,a,o,l;return t.id?(a="",t.element&&(o=e(t.element).data("avatar"))&&(a=o),a=null!==(n=t.avatar)&&void 0!==n?n:a,l=e('<span class="poly-utilities-user-search-result"><img src="'.concat(a,'" class="avatar-user"/> ').concat(t.text,"</span>"))):t.text},escapeMarkup:function escapeMarkup(e){return e}}),H.on("change",(function(t){var n=H.select2("data"),a=n.map((function(t){return{id:t.id,text:t.text,avatar:e(t.element).data("avatar")||t.avatar}}));j.value=a})))}))})),l((function(){fetchData(),e(document).on("click",".list-group.nested-sortable",(function(t){var n,a,o,l;t.preventDefault(),t.stopPropagation(),o=(a=(n=e(t.target)).closest("div")).find(".toggle-widgets i"),(l=a.find(".list-group.nested-sortable").first()).length&&(l.slideToggle(),o.hasClass("fa-caret-up")?o.removeClass("fa-caret-up").addClass("fa-caret-down"):o.removeClass("fa-caret-down").addClass("fa-caret-up"))}))})),t=function setupSortable(){var e,t=[].slice.call(document.querySelectorAll(".poly-menu .nested-sortable"));for(e=0;e<t.length;e++)new Sortable(t[e],{group:"poly-menu",animation:150,fallbackOnBody:!0,swapThreshold:.65,onStart:function onStart(e){},onAdd:function onAdd(e){var t,n=e.item,a=n.parentNode;a.classList.contains("list-group")&&(null!==(t=a.parentNode.getAttribute("data-slug"))?(n.classList.add("sub"),n.setAttribute("data-parent_slug",t)):(n.setAttribute("data-parent_slug","root"),n.classList.remove("sub")))},onEnd:function onEnd(e){updateMenuOptions()}})},n=function handleSubmit(t){var n,a;if(P.value=!0,n=e("#poly_utilities_add_custom_sidebar_form").get(0),!validationForm(a=new FormData(n),L))return P.value=!1,!1;a.set("users",JSON.stringify(j.value)),a.set("roles",JSON.stringify(D.value)),a.append("is_edit",k.value),a.append("is_custom","true"),!0===k.value&&(a.append("id",T.value.id),a.append("slug",T.value.slug),a.append("position",T.value.position)),fetch(n.action,{method:"POST",body:a}).then((function(e){if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((function(e){k.value?(window.location.reload(),PolyMessage.displayNotification("".concat(e.status),"".concat(e.message))):window.location.reload()})).catch((function(e){})).finally((function(){P.value=!1}))},i=function initDefaultValue(e){var t,n,a,o,l,r,i,u,s;e.type=null!==(t=e.type)&&void 0!==t?t:"default",e.target=null!==(n=e.target)&&void 0!==n?n:"_self",e.rel=null!==(a=e.rel)&&void 0!==a?a:"follow",e.parent_slug=null!==(o=null==e?void 0:e.parent_slug)&&void 0!==o?o:"root",e.href=null!==(l=null==e?void 0:e.href_original)&&void 0!==l?l:e.href,s=null!==(r=null==e?void 0:e.position)&&void 0!==r?r:0,s=parseInt(s),e.position=s,e.badge||(e.badge={}),e.badge.value=null!==(i=e.badge.value)&&void 0!==i?i:"",e.badge.color=null!==(u=e.badge.color)&&void 0!==u?u:""},u=function handleClone(t){var n,a,o,l,r=t.id+"_cloned";t.id=r,t.slug=r,t.is_custom=!0,i(t),t.name=PolyCommon.extractTextFromHtml(t.name),t.badge={color:null!==(n=null==t||null===(a=t.badge)||void 0===a?void 0:a.color)&&void 0!==n?n:"",value:null!==(o=null==t||null===(l=t.badge)||void 0===l?void 0:l.value)&&void 0!==o?o:""},e.post(admin_url+"poly_utilities/clone_setup_menu",{data:t}).done((function(e){var t=e;PolyMessage.displayNotification(t.status,t.message),fetchData()}))},s=function decodeHtml(e){return PolyCustomMenu.decodeHtml(e)},c=function handleIcon(e){var t=PolyCustomMenu.decodeHtml(e.icon);return t.includes("<svg")?t:'<i class="'.concat(e.icon,'">&nbsp;</i>')},d=function handleEdit(t){var n,a,o,l,r,u,s,c;PolyOperationFunctions.Scrolling(),k.value=!0,"iframe"===t.type&&t.href_original&&(t.href=t.href_original),t.roles=null!==(n=null==t?void 0:t.roles)&&void 0!==n?n:"[]",t.users=null!==(a=null==t?void 0:t.users)&&void 0!==a?a:"[]",i(t),T.value=t,null!=t&&t.icon&&(o=PolyCustomMenu.decodeHtml(t.icon)).includes("<svg")&&(T.value.svg=t.icon,T.value.icon=""),T.value.name=PolyCommon.extractTextFromHtml(T.value.name),r=(l=JSON.parse(t.roles)).map((function(e){return{id:e.id,text:e.text}})),D.value=r,u=r.map((function(e){return e.id})),O.val(u).trigger("change"),c=(s=JSON.parse(t.users)).map((function(e){return{id:e.id,text:e.text,avatar:e.avatar}})),j.value=c,H.empty(),c.forEach((function(t){var n=new Option(t.text,t.id,!0,!0);e(n).data("avatar",t.avatar),H.append(n)})),updateColorPicker()},f=PolyComponents.useFilteredTypes(T,x),{default_settings:x,dataLoaded:I,isProccessing:P,validation_fields:L,menu_items:S,custom_menu_items:A,roles:M,item_edit_object:T,is_edit:k,isEdit,handleEdit:d,decodeHtml:s,handleIcon:c,handleClone:u,handleDisabled:_=function handleDisabled(t,n){var a,o;t.preventDefault(),(a=e(t.target).closest(".onoffswitch").find('input[type="checkbox"]')).length&&(o=!a.prop("checked"),a.prop("checked",o),n.disabled=o,r().then((function(){updateMenuOptions(!0)})))},handleDelete:m=function handleDelete(t){var n={};n.id=t.slug,Swal.fire({title:poly_utilities_settings.popup_delete.header,text:poly_utilities_settings.popup_delete.message,showCancelButton:!0,confirmButtonColor:poly_utilities_settings.popup_delete.confirm_color,cancelButtonColor:poly_utilities_settings.popup_delete.cancel_color,cancelButtonText:poly_utilities_settings.popup_delete.cancel,confirmButtonText:poly_utilities_settings.popup_delete.confirm,allowOutsideClick:!1}).then((function(t){t.isConfirmed&&e.post(admin_url+"poly_utilities/delete_custom_setup_menu",n).done((function(e){window.location.reload()}))}))},handleSubmit:n,handleStaffInfo,handleRoleInfo,handleReactivationModule:h=function handleReactivationModule(){PolyCustomMenu.handleReactivationModule()},handleDividerStyles:g=function handleDividerStyles(e){return PolyCustomMenu.HandleDividerStyles(e)},handleHtmlContent:b=function handleHtmlContent(e){return PolyCustomMenu.HandleHtmlContent(e)},extractTextFromHtml:C=function extractTextFromHtml(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""},handleResetCustomMenu:v=function handleResetCustomMenu(e){PolyCustomMenu.HandleResetCustomMenu(e)},handleDeleteCustomMenu:y=function handleDeleteCustomMenu(e){PolyCustomMenu.HandleDeleteCustomMenu(e)},handleChangeLinkType:p=function handleChangeLinkType(t){var n,a;"divider"===t.type&&(n="fa-solid fa-grip-lines fa-fw",e("#name").val("Divider"),e("#badge\\[value\\]").val("2px"),e("#badge\\[color\\]").val("transparent"),e('textarea[name="icon"]').val(n),(a=e("#poly_field_aio_supports_button i")).length>0&&(a.removeClass(),a.addClass(n)))},filteredTypes:f,removeIcon:w=function removeIcon(e){null!=e&&e.icon&&(e.icon=""),null!=e&&e.svg&&(e.svg="")}}}}).mount("#polyApp")}(jQuery)}))})();